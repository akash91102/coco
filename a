processLegalAgreementProfiles = (data) => {
    let legalAgreementProfiles = [];
    const crossMarginStats = data?.compositeProfile?.legalAgreement?.attributes?.crossMarginStatistics?.value;

    if (Array.isArray(crossMarginStats) && crossMarginStats.length > 0) {
        crossMarginStats.forEach((statItem) => {
            const legalEntities = statItem?.legalEntities;
            if (Array.isArray(legalEntities) && legalEntities.length > 0) {
                legalEntities.forEach((entity) => {
                    const profilesObj = entity?.legalAgreementProfiles;
                    if (profilesObj && typeof profilesObj === 'object') {
                        Object.keys(profilesObj).forEach(agreementType => {
                            const profiles = profilesObj[agreementType];
                            if (Array.isArray(profiles)) {
                                profiles.forEach((profile, index) => {
                                    legalAgreementProfiles.push({
                                        agreementId: profile.profileId || `N/A-${agreementType}-${index}`,
                                        agreementCategory: agreementType,
                                        profileType: profile.profileType || 'N/A',
                                        legalEntityName: profile.lineOfBusiness || 'N/A',
                                        status: profile.profileStatus || 'Unknown',
                                        updatedBy: profile.updatedBy || 'N/A',
                                        updatedAt: profile.updatedAt || 'N/A',
                                        createdBy: profile.createdBy || 'N/A',
                                        version: profile.version || 0,
                                        _originalData: profile,
                                        _agreementType: agreementType
                                    });
                                });
                            }
                        });
                    }
                });
            }
        });
    }


    return legalAgreementProfiles;
};
